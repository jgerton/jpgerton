---
phase: 08-design-token-foundation
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - app/globals.css
autonomous: true

must_haves:
  truths:
    - "Every semantic color variable in :root has a corresponding .dark value that is visually different"
    - "All foreground colors have sufficient contrast against their paired background (WCAG AA minimum)"
    - "No placeholder or copy-pasted values exist between light and dark themes"
    - "Border and input colors are visible on their respective theme backgrounds"
    - "All semantic colors render correctly in components with no console warnings or build errors from malformed color definitions"
  artifacts:
    - path: "app/globals.css"
      provides: "Audited semantic color variables for :root and .dark"
      contains: "--primary:"
    - path: "app/globals.css"
      provides: "Corrected @theme inline color references (no hsl wrapping)"
      contains: "@theme inline"
  key_links:
    - from: "app/globals.css :root variables"
      to: "@theme inline color references"
      via: "CSS variable reference chain"
      pattern: "--color-primary: hsl\\(var\\(--primary\\)\\)"
    - from: "app/globals.css .dark variables"
      to: "shadcn/ui components"
      via: "Semantic color consumption"
      pattern: "bg-primary|text-primary-foreground"
---

<objective>
Audit and refine all semantic color variables in both :root and .dark themes. Verify every color is intentional (not defaulted), ensure light/dark values are distinct, check WCAG AA contrast for foreground/background pairs, and fix the redundant color definition pattern.

Purpose: Ensure the color system is a reliable foundation for all components. shadcn/ui components depend on these semantic variables, so any missing or poorly contrasted value creates visual bugs in both themes. This audit prevents compounding issues in later phases.

Output: Refined globals.css with audited color values, corrected @theme color reference pattern, and documented color intentions via inline comments.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-design-token-foundation/08-RESEARCH.md
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit semantic color variables and fix contrast issues</name>
  <files>app/globals.css</files>
  <action>
Perform a systematic audit of all semantic color variables in :root and .dark. For each variable pair:

**Audit checklist (apply to every variable):**
1. Both :root and .dark have the variable defined (no missing dark counterpart)
2. Light and dark values are DIFFERENT (not copy-pasted)
3. Foreground/background pairs meet WCAG AA contrast (4.5:1 for text, 3:1 for UI)
4. Values are intentional, not placeholder zeros

**Current variables to audit (18 semantic + 3 admin):**
- background / foreground
- card / card-foreground
- popover / popover-foreground
- primary / primary-foreground
- secondary / secondary-foreground
- muted / muted-foreground
- accent / accent-foreground
- destructive / destructive-foreground
- border
- input
- ring
- radius (not a color, skip)
- admin-bg / admin-sidebar / admin-border

**Known issues from research to verify:**
1. Primary swaps between corporate-blue (light) and tech-blue (dark) - verify this is intentional and both have sufficient contrast with their foregrounds
2. accent (turquoise 178 92% 37%) uses same value in both light and dark - check if dark mode needs a lighter or desaturated variant for reduced eye strain
3. muted-foreground (0 0% 45% light, 0 0% 65% dark) - verify contrast against muted background in both modes
4. destructive changes from 0 84% 60% (light) to 0 62% 50% (dark) - verify contrast with destructive-foreground (white)

**Contrast calculation approach:**
For each foreground/background pair, convert HSL to hex, then calculate contrast ratio. Flag any pair below 4.5:1 (text) or 3:1 (UI elements).

Key pairs to validate:
- primary-foreground on primary background (both themes)
- secondary-foreground on secondary background (both themes)
- accent-foreground on accent background (both themes)
- foreground on background (both themes)
- muted-foreground on muted background (both themes)
- card-foreground on card background (both themes)
- destructive-foreground on destructive background (both themes)

**If contrast issues are found:** Adjust the problematic HSL values to meet WCAG AA. Document the change with a comment explaining the old value and why it was changed.

**Add intention comments:** For each color variable, add a brief inline comment explaining what it represents (e.g., `--primary: 210 100% 23%; /* corporate-blue #003F75 */`). The current file has some comments but not consistently.
  </action>
  <verify>
For each foreground/background pair, calculate contrast ratio using the formula:
1. Convert HSL values to RGB
2. Calculate relative luminance
3. Calculate contrast ratio
4. Verify >= 4.5:1 for text, >= 3:1 for UI

All 8 foreground/background pairs must pass in BOTH :root and .dark themes (16 checks total).
  </verify>
  <done>All 18 semantic color variables have been audited. Every foreground/background pair meets WCAG AA contrast minimums in both themes. Each variable has an intention comment. No copy-pasted or placeholder values exist between themes.</done>
</task>

<task type="auto">
  <name>Task 2: Fix redundant color definition pattern for Tailwind v4</name>
  <files>app/globals.css</files>
  <action>
The current @theme block wraps semantic colors with hsl():
```css
--color-primary: hsl(var(--primary));
```

Per the research (Pitfall 2), the correct Tailwind v4 pattern for shadcn/ui is to use `@theme inline` to reference the bare CSS variables. The `hsl()` wrapping should happen at the point of use, not in the theme definition.

**However, this is a nuanced migration.** The current pattern works because shadcn/ui stores HSL values as bare numbers (e.g., `210 100% 23%`) and the `hsl()` wrapper in @theme creates valid color values. Changing this could break component styling if not done carefully.

**Approach:**
1. First, check how shadcn/ui components consume these colors. They use classes like `bg-primary`, `text-primary-foreground`. In Tailwind v4, these utilities need `--color-primary` to be a valid CSS color.
2. The current approach (`hsl(var(--primary))`) IS valid because it produces a complete color value.
3. The `@theme inline` approach (`var(--primary)`) would NOT work because the bare HSL numbers (e.g., `210 100% 23%`) are not a valid CSS color value.

**Conclusion:** The current pattern is actually CORRECT for this project's setup (shadcn/ui stores bare HSL triplets). Do NOT change to `@theme inline` with bare `var()` references - that would break all colors.

**What to do instead:**
1. Move the semantic color mappings from the main `@theme` block to a separate `@theme inline` block. The `inline` keyword tells Tailwind these are theme values that should NOT be tree-shaken if unused. This is the shadcn/ui recommended pattern.
2. Keep the `hsl(var(--primary))` wrapping since the CSS variables store bare HSL numbers.
3. Organize the @theme blocks clearly:
   - First `@theme` block: Brand colors (hex values), spacing, shadows, animation, easing, radius, fonts
   - Second `@theme inline` block: Semantic color mappings (hsl wrapping of CSS variables)

This separation makes the file clearer: the main @theme has self-contained token values, while @theme inline bridges the CSS variable system to Tailwind utilities.

**Important:** If the build breaks or colors look wrong after restructuring, revert and keep the current single @theme block. The restructuring is cosmetic/organizational - do not risk breakage for organization alone.
  </action>
  <verify>
1. Run `bun run build:no-aeo` - must pass
2. Open the site in dev mode and verify all colors render correctly:
   - Primary buttons show corporate blue (light) / tech blue (dark)
   - Background is white (light) / near-black (dark)
   - Muted sections have visible but subtle background tint
   - Borders are visible in both themes
3. Toggle dark mode and verify all semantic colors change appropriately
  </verify>
  <done>@theme blocks are organized with clear separation between self-contained tokens and semantic color mappings. The hsl() wrapping is preserved for shadcn/ui compatibility. Build passes and all colors render correctly in both themes.</done>
</task>

</tasks>

<verification>
1. `bun run build:no-aeo` passes with zero errors
2. Every semantic color variable in :root has a distinct .dark counterpart
3. All 8 foreground/background pairs meet WCAG AA contrast in both themes
4. @theme blocks are logically organized
5. Intention comments exist on all color variables
6. Dark mode toggle works correctly with all colors transitioning properly
</verification>

<success_criteria>
- 18 semantic color variables audited with intention comments
- All foreground/background pairs pass WCAG AA contrast (4.5:1 text, 3:1 UI)
- No copy-pasted values between :root and .dark
- @theme blocks cleanly organized (tokens separate from semantic mappings)
- Build passes, colors render correctly in both themes
</success_criteria>

<output>
After completion, create `.planning/phases/08-design-token-foundation/08-02-SUMMARY.md`
</output>
