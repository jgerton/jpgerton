---
phase: 14-performance-accessibility-validation
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - components/navigation/mobile-menu.tsx
  - components/navigation/site-nav.tsx
  - components/portfolio/sections/hero-with-gradient.tsx
  - components/portfolio/cta-button.tsx
  - components/forms/contact-form.tsx
  - app/globals.css
autonomous: true

must_haves:
  truths:
    - "Keyboard Tab key navigates through all interactive elements in logical order on every page"
    - "Visible focus ring appears on every focusable element during keyboard navigation"
    - "Mobile menu traps focus when open and returns focus to trigger button on close"
    - "All buttons and links have a minimum 44x44px touch target area"
    - "Escape key closes the mobile menu"
  artifacts:
    - path: "components/navigation/mobile-menu.tsx"
      provides: "Focus trap and focus restoration in mobile menu"
    - path: ".planning/phases/14-performance-accessibility-validation/14-02-audit-results.md"
      provides: "Keyboard and touch target validation results"
  key_links:
    - from: "mobile menu open"
      to: "focus trap inside dialog"
      via: "focus management on role=dialog"
      pattern: "focus|trap|tabindex"
    - from: "mobile menu close"
      to: "focus returns to hamburger button"
      via: "ref to trigger element"
      pattern: "ref|focus\\(\\)"
---

<objective>
Validate and fix keyboard navigation, focus management, and touch target sizing across the entire site.

Purpose: Ensure the site is fully navigable via keyboard (A11Y-02), focus is properly managed in the mobile menu dialog (A11Y-06), and all interactive elements meet the 44x44px touch target minimum (A11Y-03).

Output: Keyboard navigation works logically on every page, mobile menu has proper focus trap and focus restoration, and all primary interactive elements meet touch target requirements.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-performance-accessibility-validation/14-CONTEXT.md
@.planning/phases/14-performance-accessibility-validation/14-RESEARCH.md
@.planning/phases/14-performance-accessibility-validation/14-01-SUMMARY.md
@components/navigation/site-nav.tsx
@components/navigation/mobile-menu.tsx
@components/portfolio/sections/hero-with-gradient.tsx
@hooks/use-intersection-observer.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate and fix keyboard navigation and focus management</name>
  <files>
    components/navigation/mobile-menu.tsx
    components/navigation/site-nav.tsx
    app/globals.css
    .planning/phases/14-performance-accessibility-validation/14-02-audit-results.md
  </files>
  <action>
    **Keyboard Navigation Validation:**

    Use the Chrome extension to test keyboard navigation on each page. Navigate via `/chrome navigate` to each page and use `/chrome inspect` to check the DOM for focusable elements.

    Check each page for:
    1. Tab order follows visual/reading order (top-to-bottom, left-to-right)
    2. No focusable elements are skipped or hidden behind animations
    3. Focus ring is visible on every interactive element (links, buttons, inputs, select)
    4. No keyboard traps (can Tab forward and Shift+Tab backward through everything)

    **Focus-in-animated-content check (Pitfall 5 from research):**
    The home page has staggered entrance animations using opacity:0. Elements with opacity:0 are still focusable. Check:
    - Services section cards: are they focusable before visible?
    - Project grid items: are they focusable before visible?

    If elements are keyboard-focusable while invisible (opacity:0, not yet animated):
    - Do NOT add tabindex="-1" (breaks accessibility after animation)
    - Instead, verify the intersection observer triggers quickly enough that this is not a practical issue
    - If it IS a practical issue (user could Tab to invisible content), add `visibility: hidden` to the pre-animation state and `visibility: visible` to the post-animation state. Visibility prevents focus while opacity allows smooth transition.

    **Mobile Menu Focus Management (A11Y-06):**
    The mobile menu (`components/navigation/mobile-menu.tsx`) already has:
    - `role="dialog"` and `aria-modal="true"` (good)
    - Escape key handler (good)
    - Scroll lock (good)
    - Backdrop click to close (good)

    What it's MISSING (verify and fix):
    1. **Focus trap**: When menu opens, focus should be trapped inside the dialog. Tab from the last link should cycle to the first link, not escape to the page behind.
       - Add a focus trap: on open, focus the first nav link. Track first and last focusable elements. On Tab from last element, focus first. On Shift+Tab from first element, focus last.
    2. **Focus restoration**: When menu closes, focus should return to the hamburger button that opened it.
       - In `site-nav.tsx`, create a ref for the hamburger button. Pass it to MobileMenu or use a callback pattern. On close, call `buttonRef.current?.focus()`.
    3. **Initial focus**: When menu opens, focus should move to the first nav link inside the panel (not stay on the hamburger button behind the backdrop).

    Implementation approach for focus trap (keep it simple, no library):
    ```tsx
    // In MobileMenu, after isOpen becomes true:
    useEffect(() => {
      if (!isOpen) return;

      const panel = panelRef.current;
      if (!panel) return;

      const focusableElements = panel.querySelectorAll<HTMLElement>(
        'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
      );

      const firstEl = focusableElements[0];
      const lastEl = focusableElements[focusableElements.length - 1];

      // Focus first element on open
      firstEl?.focus();

      function handleKeyDown(e: KeyboardEvent) {
        if (e.key === 'Tab') {
          if (e.shiftKey && document.activeElement === firstEl) {
            e.preventDefault();
            lastEl?.focus();
          } else if (!e.shiftKey && document.activeElement === lastEl) {
            e.preventDefault();
            firstEl?.focus();
          }
        }
      }

      panel.addEventListener('keydown', handleKeyDown);
      return () => panel.removeEventListener('keydown', handleKeyDown);
    }, [isOpen]);
    ```

    For focus restoration in `site-nav.tsx`:
    ```tsx
    const menuButtonRef = useRef<HTMLButtonElement>(null);

    // Pass to button:
    <button ref={menuButtonRef} ...>

    // On close, restore focus:
    function handleClose() {
      setMobileMenuOpen(false);
      menuButtonRef.current?.focus();
    }
    ```

    **Global focus ring verification:**
    Check `app/globals.css` for the `*:focus-visible` rule added in Phase 12. Verify it produces a visible ring on:
    - Buttons (all variants)
    - Links (nav links, inline links)
    - Form inputs (text, email, select, textarea)
    - Theme toggle button

    If any element's focus ring is invisible or obscured, add a specific override.

    Document all findings and fixes in 14-02-audit-results.md.
  </action>
  <verify>
    `bun run lint` passes.
    `bun run type-check` passes.
    `bun run build` passes.
    Mobile menu has focus trap implementation.
    Focus restoration to hamburger button on close.
  </verify>
  <done>
    Keyboard Tab navigates all pages in logical order. Mobile menu traps focus, restores focus on close, and focuses first link on open. Global focus ring visible on all interactive elements. No elements are focusable while invisible.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate and fix touch target sizes</name>
  <files>
    components/portfolio/cta-button.tsx
    components/forms/contact-form.tsx
    app/globals.css
  </files>
  <action>
    **Touch Target Validation (A11Y-03):**

    Use Chrome DevTools responsive mode at 375px width to inspect touch target sizes.

    Check these interactive elements for 44x44px minimum clickable area (including padding):

    1. **Navigation:**
       - Hamburger menu button (currently `p-2` = 8px padding on a 20px icon = 36px total - likely FAILS 44px)
       - Theme toggle button (Button size="icon" - check if it's 44px)
       - Mobile menu nav links (text links - need sufficient padding)

    2. **Hero CTAs:**
       - "Get Your Business Online" button (CTAButton size="xl" - likely passes)
       - "See My Work" button (Button size="lg" - likely passes)

    3. **Page CTAs and links:**
       - All Button components with size="lg" or larger - likely pass
       - "View Pricing & Details" link button on home page (variant="link" - may be too small)
       - Footer links (if any)
       - Social/external links on contact page

    4. **Form inputs:**
       - Input fields (h-10 = 40px - close to 44px, check with padding)
       - Select dropdown on contact form
       - Submit button

    5. **Project cards:**
       - The entire card should be clickable, not just the title text
       - Badge/filter buttons on projects page

    **Fixes to apply:**

    For elements below 44px, increase clickable area via padding (not visual size change):
    - Hamburger button: increase from `p-2` to `p-2.5` or `min-h-[44px] min-w-[44px]` to ensure 44px touch target
    - Theme toggle: if below 44px, add `min-h-[44px] min-w-[44px]`
    - Small text links: add padding to increase touch area while keeping visual appearance

    Requirement says 44x44px. Apply 44px to primary interactive elements (CTAs, nav buttons, form submit). For inline text links (like email on contact page), 44px height via line-height/padding is sufficient.

    Do NOT change visual design significantly. Use min-height/min-width and padding to increase touch target without changing visual size of the element.

    Run after fixes:
    ```
    bun run lint
    bun run type-check
    bun run build
    ```

    Update 14-02-audit-results.md with touch target findings and fixes.
  </action>
  <verify>
    `bun run build` passes.
    Hamburger button has at least 44x44px touch target.
    Theme toggle has at least 44x44px touch target.
    All primary CTA buttons meet 44x44px.
    Form submit button meets 44x44px.
  </verify>
  <done>
    All primary interactive elements (buttons, nav controls, form inputs) meet 44x44px minimum touch target. Fixes applied via padding/min-size without changing visual design. Touch target audit documented.
  </done>
</task>

</tasks>

<verification>
- Tab key navigates every page in logical visual order
- Focus ring visible on every focusable element
- Mobile menu: focus trapped inside, focus restored to trigger on close
- Escape closes mobile menu
- Hamburger button touch target >= 44x44px
- Theme toggle touch target >= 44x44px
- All CTA buttons >= 44x44px
- Form submit button >= 44x44px
- `bun run build` passes
</verification>

<success_criteria>
- Full keyboard navigation works on every public page with visible focus indicators
- Mobile menu implements focus trap and focus restoration
- All primary interactive elements meet 44x44px touch target minimum
- No elements are keyboard-focusable while invisible (animation pre-state)
- Keyboard and touch target audit documented with findings and fixes
</success_criteria>

<output>
After completion, create `.planning/phases/14-performance-accessibility-validation/14-02-SUMMARY.md`
</output>
