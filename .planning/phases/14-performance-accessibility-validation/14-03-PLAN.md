---
phase: 14-performance-accessibility-validation
plan: 03
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - app/globals.css
  - components/navigation/site-nav.tsx
autonomous: true

must_haves:
  truths:
    - "All text passes WCAG AA contrast (4.5:1) in dark mode"
    - "All UI elements (borders, icons, focus rings) pass WCAG AA contrast (3:1) in dark mode"
    - "Dark mode colors are intentionally chosen warm blue-gray palette, not inverted light mode"
    - "Hover, focus, active, and disabled states maintain proper contrast in dark mode"
    - "Safari-specific CSS quirks are documented or fixed (backdrop-filter prefixing)"
  artifacts:
    - path: ".planning/phases/14-performance-accessibility-validation/14-03-audit-results.md"
      provides: "Dark mode contrast verification results and Safari compatibility findings"
    - path: "app/globals.css"
      provides: "Any dark mode contrast fixes"
  key_links:
    - from: "dark mode CSS variables (:root .dark)"
      to: "component rendered colors"
      via: "Tailwind semantic color utilities"
      pattern: "muted-foreground|border|accent"
---

<objective>
Validate dark mode rendering with intentional design review, verify all contrast ratios in dark mode, and check Safari CSS compatibility via code inspection heuristics.

Purpose: Confirm that the warm blue-gray dark mode designed in Phase 10 still meets WCAG AA contrast after Phases 11-13 added new components and color combinations. Also verify Safari compatibility for known CSS quirks (A11Y-05, A11Y-07).

Output: All dark mode text/UI contrast verified at WCAG AA, Safari quirks documented or fixed, hover/focus/active/disabled states validated in dark mode.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-performance-accessibility-validation/14-CONTEXT.md
@.planning/phases/14-performance-accessibility-validation/14-RESEARCH.md
@.planning/phases/14-performance-accessibility-validation/14-01-SUMMARY.md
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dark mode contrast verification across all pages</name>
  <files>
    app/globals.css
    .planning/phases/14-performance-accessibility-validation/14-03-audit-results.md
  </files>
  <action>
    **Dark Mode Color Variable Audit:**

    First, read the complete `app/globals.css` to extract all dark mode CSS variables (the `.dark` block inside `@layer base`). Create a contrast matrix for every text-on-background combination.

    Key color pairs to verify (dark mode values):
    1. `--foreground` on `--background` (main body text) - must be >= 4.5:1
    2. `--muted-foreground` on `--background` (secondary text) - must be >= 4.5:1
    3. `--muted-foreground` on `--muted` (secondary text on muted sections) - must be >= 4.5:1
    4. `--muted-foreground` on `--card` (secondary text inside cards) - must be >= 4.5:1
    5. `--foreground` on `--card` (primary text inside cards) - must be >= 4.5:1
    6. `--primary` on `--background` (links, primary UI elements) - must be >= 3:1 for UI, 4.5:1 for text
    7. `--primary-foreground` on `--primary` (text on primary buttons) - must be >= 4.5:1
    8. `--accent-warm-foreground` on `--accent-warm` (warm CTA button text) - must be >= 4.5:1
    9. `--destructive-foreground` on `--destructive` (error states) - must be >= 4.5:1
    10. `--border` on `--background` (card/section borders) - must be >= 3:1 for UI
    11. `--border` on `--card` (borders on cards) - must be >= 3:1 for UI
    12. `--ring` color (focus ring) on `--background` - must be >= 3:1

    For each pair, compute the contrast ratio using the WCAG luminance formula:
    1. Convert HSL to RGB (the CSS vars use HSL format like "220 15% 10%")
    2. Compute relative luminance: L = 0.2126 * R + 0.7152 * G + 0.0722 * B (where R/G/B are linearized)
    3. Contrast ratio = (L1 + 0.05) / (L2 + 0.05) where L1 > L2

    Write a temporary Node script to calculate all ratios (delete after use).

    **Visual Dark Mode Check:**

    Use the Chrome extension to navigate to each page in dark mode:
    1. `/chrome navigate http://localhost:3400`
    2. Toggle to dark mode via the theme toggle button
    3. `/chrome screenshot` to capture dark mode rendering
    4. Check each page for:
       - Text readability (no low-contrast text)
       - Card borders visible against background
       - Badge text readable
       - CTA buttons with sufficient contrast
       - Muted text on muted backgrounds
       - Hover states: verify hover color changes are visible
       - Focus states: verify focus ring stands out

    Pages to check in dark mode:
    - / (home) - hero gradient, service cards, testimonial cards, CTA banner
    - /services - pricing cards, FAQ items, trust metrics
    - /about - process step cards, value cards, prose text
    - /contact - contact form, booking card with primary border
    - /projects - filter buttons, project cards

    **Interactive States in Dark Mode:**
    Check that these states maintain contrast:
    - Button hover: bg changes should remain visible against dark background
    - Button active/pressed: scale change + color visible
    - Button disabled: visually distinct from enabled but not invisible
    - Link hover: underline or color change visible
    - Input focus: focus ring visible on dark input background
    - Input error: destructive border visible on dark background

    **Fix any failures:**
    - Adjust dark mode CSS variables in globals.css `.dark` block
    - Subtle adjustments only (slightly lighter text, slightly more opaque borders)
    - Do NOT change the warm blue-gray aesthetic. Protect the design.
    - Phase 10 established: background 10%, card 13%, popover 16% (+3% per level). Maintain this hierarchy.

    Document all findings in 14-03-audit-results.md with:
    - Contrast ratio table (pair, ratio, pass/fail)
    - Visual check results per page
    - Interactive state verification
    - Fixes applied (if any)
  </action>
  <verify>
    All contrast ratios >= 4.5:1 for text, >= 3:1 for UI elements.
    `bun run build` passes.
    14-03-audit-results.md documents all verified color pairs with ratios.
  </verify>
  <done>
    Every text/UI color combination in dark mode verified at WCAG AA contrast. Interactive states (hover, focus, active, disabled) maintain proper contrast. Any regressions fixed. Dark mode maintains warm blue-gray aesthetic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Safari CSS compatibility heuristic check</name>
  <files>
    components/navigation/site-nav.tsx
  </files>
  <action>
    **Safari Compatibility Checks (no direct Safari access):**

    Since user has no direct Safari access, perform code-level checks for known Safari CSS quirks documented in the research.

    **Check 1: backdrop-filter prefixing**
    Grep the codebase for `backdrop-filter` usage. Current finding: site-nav.tsx uses Tailwind's `backdrop-blur-md` utility.

    Verify that Tailwind v4 outputs the `-webkit-backdrop-filter` prefix. Check:
    - Does `backdrop-blur-md` in Tailwind v4 auto-prefix with `-webkit-`?
    - The site-nav also has `supports-[backdrop-filter]:bg-background/60` which is the correct progressive enhancement pattern
    - The `before:backdrop-blur-md` pseudo-element also needs prefixing

    If Tailwind v4 does NOT auto-prefix `-webkit-backdrop-filter`, add a manual CSS rule in globals.css:
    ```css
    @supports (-webkit-backdrop-filter: blur(1px)) {
      .backdrop-blur-md {
        -webkit-backdrop-filter: blur(12px);
      }
    }
    ```

    However, Tailwind v4 uses Lightning CSS which auto-prefixes. Verify by checking the built CSS output:
    ```
    bun run build
    ```
    Then inspect `.next/static/css/` for `-webkit-backdrop-filter` in the output.

    **Check 2: CSS variables in -webkit- properties**
    Grep for any `-webkit-` properties that use `var()`. This is NOT supported in Safari.
    In the current codebase, backdrop-filter uses Tailwind utilities (not CSS variables), so this should be fine.

    **Check 3: CSS Grid gap compatibility**
    Safari historically had issues with `gap` in flexbox. Modern Safari supports it, but verify:
    - Grep for `gap-` usage in flex containers
    - All modern Safari (16+) supports flexbox gap, so this is low risk

    **Check 4: Smooth scroll behavior**
    If `scroll-behavior: smooth` is used, Safari has had issues. Check globals.css.

    **Check 5: CSS `clamp()` in font-size**
    The project uses `clamp()` for fluid typography. Safari supports clamp() since 13.1+ (2020). No issue for modern Safari.

    **Check 6: Tailwind v4 gradient syntax**
    The project uses `bg-linear-to-br` (Tailwind v4 syntax). Verify this compiles to `background: linear-gradient(to bottom right, ...)` in built CSS, which Safari supports.

    Document findings in the "Safari Compatibility" section of 14-03-audit-results.md:
    - For each check: what was checked, result, action taken
    - Note any items that cannot be verified without real Safari access
    - Recommendation: test on Safari when available (not blocking for this phase)
  </action>
  <verify>
    Built CSS includes `-webkit-backdrop-filter` prefix (or Tailwind/Lightning CSS handles it).
    No CSS variables used inside `-webkit-` properties.
    14-03-audit-results.md documents Safari compatibility findings.
  </verify>
  <done>
    Safari CSS compatibility verified via code inspection. backdrop-filter prefixing confirmed. No CSS variable issues in -webkit- properties. Known Safari quirks documented. Items that need real Safari testing are flagged but not blocking.
  </done>
</task>

</tasks>

<verification>
- All dark mode text/UI contrast ratios documented and passing WCAG AA
- Interactive states (hover, focus, active, disabled) verified in dark mode
- Dark mode maintains warm blue-gray aesthetic from Phase 10
- Safari backdrop-filter prefixing verified in built CSS
- No CSS variables in -webkit- properties
- `bun run build` passes
- Audit results documented in 14-03-audit-results.md
</verification>

<success_criteria>
- Zero WCAG AA contrast failures in dark mode (4.5:1 text, 3:1 UI)
- Dark mode renders with intentional warm blue-gray palette, not generic inversion
- All interactive states maintain contrast in dark mode
- Safari CSS compatibility documented (known quirks checked via code inspection)
- Any unverifiable Safari items flagged (not blocking)
</success_criteria>

<output>
After completion, create `.planning/phases/14-performance-accessibility-validation/14-03-SUMMARY.md`
</output>
