---
phase: 09-component-variant-extensions
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/ui/badge.tsx
  - components/ui/input.tsx
  - components/ui/form.tsx
  - components/ui/textarea.tsx
autonomous: true

must_haves:
  truths:
    - "Badge component renders tech stack tags with subtle brand-tinted backgrounds that differ by category (frontend, backend, tool, skill)"
    - "Form inputs show a visible brand-colored focus ring when focused"
    - "Form inputs with errors show red border and inline error text below the field"
    - "Form inputs with success show green border (matching the error pattern)"
    - "Form labels are static above inputs, not floating"
    - "Existing Badge usages (default, secondary, outline, destructive) continue to work"
  artifacts:
    - path: "components/ui/badge.tsx"
      provides: "Badge with tech stack category variants (frontend, backend, tool, skill)"
      exports: ["Badge", "badgeVariants"]
      contains: "frontend"
    - path: "components/ui/input.tsx"
      provides: "Input with validation state variants (default, error, success) and auto-error via aria-invalid"
      exports: ["Input", "inputVariants"]
      contains: "inputVariants"
    - path: "components/ui/form.tsx"
      provides: "FormMessage with role=alert for accessible error announcements"
      exports: ["Form", "FormField", "FormItem", "FormLabel", "FormControl", "FormDescription", "FormMessage", "useFormField"]
      contains: "role.*alert"
    - path: "components/ui/textarea.tsx"
      provides: "Textarea with same validation state variants as Input and auto-error via aria-invalid"
      exports: ["Textarea", "textareaVariants"]
  key_links:
    - from: "components/ui/input.tsx"
      to: "class-variance-authority"
      via: "cva import for inputVariants"
      pattern: "inputVariants"
    - from: "components/ui/form.tsx"
      to: "components/ui/input.tsx"
      via: "FormControl sets aria-invalid which Input auto-styles via CSS"
      pattern: "aria-invalid"
    - from: "components/ui/input.tsx"
      to: "components/ui/form.tsx"
      via: "Input base styles include aria-invalid:border-destructive so FormControl error state auto-applies red border without manual prop passing"
      pattern: "aria-invalid:border-destructive"
---

<objective>
Refine Badge, Input, Textarea, and Form components with validation states and brand-tinted tech stack categories.

Purpose: Badge gets tech stack category variants (frontend/backend/tool/skill) with subtle brand-tinted backgrounds for the project detail pages. Input and Textarea get validation state variants (default/error/success) with proper focus rings and border colors. Form components get enhanced error display with role="alert" for accessibility. These refinements make forms feel polished and give tech stack badges brand personality.

Output: Updated badge.tsx with category variants, input.tsx with validation states, textarea.tsx with matching validation states, and form.tsx with enhanced error presentation.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-component-variant-extensions/09-CONTEXT.md
@.planning/phases/09-component-variant-extensions/09-RESEARCH.md
@components/ui/badge.tsx
@components/ui/input.tsx
@components/ui/form.tsx
@components/ui/textarea.tsx
@components/forms/contact-form.tsx
@app/projects/[slug]/page.tsx
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tech stack category variants to Badge</name>
  <files>components/ui/badge.tsx</files>
  <action>
Extend the badgeVariants CVA definition in badge.tsx to include 4 tech stack category variants using subtle brand tints (10% opacity backgrounds). This is the "approachable professional" approach -- brand colors provide visual differentiation without being aggressive.

**Add these variants to the existing variants object (keep all existing variants):**
- `frontend`: `border-transparent bg-tech-blue/10 text-tech-blue dark:bg-tech-blue/20 dark:text-tech-blue transition-colors duration-[var(--duration-fast)]`
- `backend`: `border-transparent bg-corporate-blue/10 text-corporate-blue dark:bg-corporate-blue/20 dark:text-corporate-blue transition-colors duration-[var(--duration-fast)]`
- `tool`: `border-transparent bg-turquoise/10 text-turquoise dark:bg-turquoise/20 dark:text-turquoise transition-colors duration-[var(--duration-fast)]`
- `skill`: `border-transparent bg-accent/50 text-accent-foreground dark:bg-accent/20 dark:text-accent-foreground transition-colors duration-[var(--duration-fast)]`

**Color mapping rationale:**
- frontend (React, Next.js, TypeScript) = tech-blue (the technology blue from brand palette)
- backend (Node, Python, databases) = corporate-blue (the deeper, more serious blue)
- tool (Docker, Git, VS Code) = turquoise (the fresh, utility-focused color)
- skill (design, architecture, testing) = accent (turquoise-derived semantic color)

**Keep existing variants unchanged:** default, secondary, destructive, outline. The defaultVariant remains "default".

Do NOT change the Badge function signature or component structure. Only extend the variants object.
  </action>
  <verify>
Run `bun run build` to confirm no TypeScript errors. Verify existing Badge usages still work by confirming the build succeeds. Programmatically verify that brand color tokens (tech-blue, corporate-blue, turquoise) are defined in globals.css by grepping for `--color-tech-blue`, `--color-corporate-blue`, and `--color-turquoise` in `app/globals.css`.
  </verify>
  <done>
badge.tsx has 8 variant options: default, secondary, destructive, outline (existing) plus frontend, backend, tool, skill (new). Each new variant uses brand color at 10% opacity for backgrounds with full color text. Build passes, existing usages unchanged. Brand color tokens confirmed present in globals.css.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add validation state variants to Input, Textarea, and enhance Form error display</name>
  <files>components/ui/input.tsx, components/ui/textarea.tsx, components/ui/form.tsx</files>
  <action>
**Input (input.tsx):**
Convert Input from direct className to CVA-powered validation state variants.

Add imports: `import { cva, type VariantProps } from "class-variance-authority";`

Create inputVariants:
```
const inputVariants = cva(
  "flex h-10 w-full rounded-md bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm transition-colors duration-[var(--duration-fast)]",
  {
    variants: {
      validationState: {
        default: "border border-input focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
        error: "border-2 border-destructive focus-visible:ring-2 focus-visible:ring-destructive focus-visible:ring-offset-2",
        success: "border-2 border-green-600 dark:border-green-500 focus-visible:ring-2 focus-visible:ring-green-600 dark:focus-visible:ring-green-500 focus-visible:ring-offset-2",
      },
    },
    defaultVariants: {
      validationState: "default",
    },
  }
);
```

Update InputProps to extend VariantProps<typeof inputVariants>. Destructure validationState in the component. Use `cn(inputVariants({ validationState, className }))`. Export inputVariants.

**CRITICAL - Auto-error wiring via aria-invalid:**
In addition to the explicit `validationState` prop, add `aria-invalid` CSS selectors to the Input BASE classes (in the cva first argument) so that when FormControl sets `aria-invalid="true"` on the Input, it automatically gets error styling WITHOUT needing `validationState="error"` to be manually passed.

Add these classes to the base string of inputVariants:
`aria-invalid:border-destructive aria-invalid:border-2 aria-invalid:focus-visible:ring-destructive`

This creates a two-tier system:
1. **Automatic (via FormControl):** When used inside `<FormControl>`, the Slot passes `aria-invalid={!!error}` to Input. The `aria-invalid:` CSS modifiers automatically apply error border/ring styling. No manual prop passing needed.
2. **Explicit (via validationState prop):** For standalone usage outside FormControl (or for success state), pass `validationState="error"` or `validationState="success"` directly.

The automatic approach takes priority because `aria-invalid:border-destructive` and `aria-invalid:border-2` will override the default variant's `border border-input` when aria-invalid is true. This means existing FormControl + Input usage (like in contact-form.tsx) will get error styling automatically with zero changes.

**Textarea (components/ui/textarea.tsx):**
Read the existing textarea.tsx first. Apply the same pattern as Input: add CVA textareaVariants with matching validationState variants (default, error, success) AND the same `aria-invalid:` base classes for automatic FormControl wiring. Export textareaVariants.

**Form (form.tsx):**
Enhance FormMessage to include `role="alert"` for accessible error announcements. The existing FormMessage renders error text in destructive color. Add `role="alert"` to the `<p>` element so screen readers announce errors immediately when they appear.

Also ensure FormLabel shows `text-destructive` only when there's an error (this is already implemented, just verify it stays).

Do NOT change FormControl's aria-invalid behavior -- it already correctly sets `aria-invalid={!!error}` which is the proper pattern (only invalid when there's an error from react-hook-form, not on initial render).

**Important:** Do not set aria-invalid="true" on initial render. The existing pattern (driven by react-hook-form error state) is correct -- errors only appear after field interaction or form submission.

**Form labels are static:** The FormLabel component renders as a standard `<Label>` with `htmlFor` pointing to the input. It is positioned above the input by the FormItem's `space-y-2` layout. Do NOT add any floating label behavior. Labels stay static above their inputs at all times.
  </action>
  <verify>
Run `bun run build` to confirm no TypeScript errors. Verify the contact form (components/forms/contact-form.tsx) still works -- it uses Input and FormControl without passing validationState, so it should fall back to "default" via defaultVariants AND get automatic error styling via aria-invalid when form validation fails. Grep for `aria-invalid:border-destructive` in input.tsx and textarea.tsx to confirm the auto-wiring CSS classes are present. Verify that FormLabel does NOT contain any floating/animated positioning classes (no `absolute`, no `transform`, no `-translate-y`) -- confirming labels remain static.
  </verify>
  <done>
Input has inputVariants with 3 validation states (default, error, success) PLUS aria-invalid CSS modifiers in the base classes for automatic FormControl wiring. Textarea has textareaVariants with matching states and aria-invalid wiring. FormMessage has role="alert" for screen reader announcements. FormControl's aria-invalid passes through to Input/Textarea and auto-applies error styling via CSS selectors. FormLabel remains static (no floating behavior). All existing form usages work unchanged. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `bun run build` completes with zero errors
2. Existing Badge usages render identically:
   - `<Badge variant="default">` in ProjectCard
   - `<Badge variant="secondary">` in project detail tech stack
   - `<Badge variant="outline">` in ProjectFilters
3. New Badge variants available: `<Badge variant="frontend">` etc.
4. Existing Input/Textarea usages render identically (defaultVariants)
5. Contact form works without changes -- AND when validation fails, Input auto-shows red border via aria-invalid CSS selectors (no manual validationState prop needed)
6. FormMessage has role="alert" for accessibility
7. FormLabel is static above inputs (no floating behavior)
8. Brand color tokens (tech-blue, corporate-blue, turquoise) confirmed in globals.css
</verification>

<success_criteria>
- Badge has 8 variant options including 4 tech stack categories
- Input has validationState variant with 3 options (default, error, success)
- Input base classes include aria-invalid:border-destructive for automatic FormControl wiring
- Textarea has matching validationState variant and aria-invalid wiring
- FormMessage has role="alert" for accessible error announcements
- Focus rings use brand-colored ring (--ring token)
- Error state shows destructive border (both via explicit prop and via aria-invalid auto-detection)
- Success state shows green border
- Form labels are static above inputs, not floating
- Build passes with zero errors
- No existing component usage breaks
</success_criteria>

<output>
After completion, create `.planning/phases/09-component-variant-extensions/09-02-SUMMARY.md`
</output>
