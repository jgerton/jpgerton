---
phase: 12-animation-integration
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - hooks/use-intersection-observer.ts
  - components/portfolio/project-grid.tsx
  - app/(home)/page.tsx
autonomous: true

must_haves:
  truths:
    - "Content sections below the fold animate into view with a smooth fade-up (opacity 0->1, translateY 20px->0) the first time they scroll into the viewport"
    - "Sibling elements in card grids stagger with ~50ms delay between items, creating a subtle flow rather than all appearing at once"
    - "Scroll animations play only once - scrolling back up and then down does not replay the animation"
    - "Hero section is fully visible on page load with no scroll-triggered animation"
    - "Users with prefers-reduced-motion see all content immediately without any entrance animation"
  artifacts:
    - path: "hooks/use-intersection-observer.ts"
      provides: "Reusable Intersection Observer hook for scroll-triggered visibility detection"
      exports: ["useIntersectionObserver"]
    - path: "components/portfolio/project-grid.tsx"
      provides: "Project card grid with staggered fade-up entrance animation"
      contains: "useIntersectionObserver"
    - path: "app/(home)/page.tsx"
      provides: "Home page with scroll-animated project section heading"
      contains: "useIntersectionObserver"
  key_links:
    - from: "hooks/use-intersection-observer.ts"
      to: "components/portfolio/project-grid.tsx"
      via: "import useIntersectionObserver"
      pattern: "useIntersectionObserver"
    - from: "hooks/use-intersection-observer.ts"
      to: "app/(home)/page.tsx"
      via: "import useIntersectionObserver"
      pattern: "useIntersectionObserver"
    - from: "hooks/use-intersection-observer.ts"
      to: "prefers-reduced-motion"
      via: "window.matchMedia check"
      pattern: "prefers-reduced-motion"
---

<objective>
Create the useIntersectionObserver hook and apply scroll-triggered entrance animations to key sections on the home page.

Purpose: Make the site feel alive and intentional by animating key content into view as users scroll, following the "refined and confident" motion personality. Only ~30% of elements get animations (project cards, section headings), while body text and standard content appears without animation. Hero remains fully visible on load.

Output: Reusable Intersection Observer hook, animated project grid with staggered card entrances, animated section heading on home page.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-animation-integration/12-RESEARCH.md
@.planning/phases/12-animation-integration/12-CONTEXT.md
@.planning/phases/12-animation-integration/12-01-SUMMARY.md
@hooks/use-intersection-observer.ts
@components/portfolio/project-grid.tsx
@app/(home)/page.tsx
@components/portfolio/hero-section.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useIntersectionObserver hook with reduced-motion awareness</name>
  <files>hooks/use-intersection-observer.ts</files>
  <action>
Create a new file `hooks/use-intersection-observer.ts` with a custom React hook.

The hook should:

1. Accept an options object with:
   - `threshold` (default: 0.1) - percentage of element visible before triggering
   - `rootMargin` (default: "50px") - margin around viewport for early trigger
   - `triggerOnce` (default: true) - only animate once per element (CONTEXT.md: once only, no replay)

2. Return:
   - `elementRef` - a React ref to attach to the target element
   - `isVisible` - boolean state indicating whether element is in view

3. Implementation details:
   - Use `useRef<T extends HTMLElement>` with generic type parameter for flexibility
   - Use `useState(false)` for isVisible tracking
   - In `useEffect`, create an IntersectionObserver with the provided options
   - When entry.isIntersecting is true, set isVisible to true
   - When triggerOnce is true (default), call `observer.unobserve(element)` after first trigger to prevent replay and free resources
   - Return cleanup function that calls `observer.disconnect()`

4. **prefers-reduced-motion support** (critical):
   - At the start of the useEffect, check `window.matchMedia('(prefers-reduced-motion: reduce)').matches`
   - If true, immediately set `isVisible(true)` and return without creating an observer
   - This ensures reduced-motion users see all content immediately with no animation delay
   - This is the JavaScript counterpart to the CSS global disable in globals.css (from Plan 12-01)

5. JSDoc comment on the function explaining purpose, parameters, and return values.

Example signature:
```typescript
export function useIntersectionObserver<T extends HTMLElement = HTMLDivElement>(
  options?: UseIntersectionObserverOptions
): { elementRef: React.RefObject<T | null>; isVisible: boolean }
```

Do NOT add any CSS classes or styles in this file. This is pure JavaScript behavior.
Do NOT use any external libraries. Intersection Observer API is browser-native.
The hook file goes in the project root `hooks/` directory (same level as `hooks/use-toast.ts`).
  </action>
  <verify>Run `bun run build` to confirm TypeScript compiles correctly with no errors. Check that the file exports `useIntersectionObserver` and the `UseIntersectionObserverOptions` interface type.</verify>
  <done>hooks/use-intersection-observer.ts exports a working useIntersectionObserver hook that detects viewport intersection, fires once by default, and immediately resolves for users with prefers-reduced-motion enabled.</done>
</task>

<task type="auto">
  <name>Task 2: Apply scroll entrance animations to project grid and home page section headings</name>
  <files>components/portfolio/project-grid.tsx, app/(home)/page.tsx</files>
  <action>
Apply scroll-triggered entrance animations to key sections on the home page. Follow the CONTEXT.md constraint: ~30% of elements animated (project cards, section headings only). Hero section stays fully visible on load. Body text and standard content appears without animation.

**A. Modify `components/portfolio/project-grid.tsx`:**

The ProjectGrid component renders a grid of ProjectCard or ProjectCardEnhanced components. Read the current file first to understand its structure.

Add scroll-triggered staggered fade-up to the grid:
1. Add `"use client"` directive at the top if not already present (hook requires client component)
2. Import `useIntersectionObserver` from `@/hooks/use-intersection-observer`
3. Import `cn` from `@/lib/utils` if not already imported
4. Inside the component, call `useIntersectionObserver()` with default options (threshold: 0.1, rootMargin: "50px", triggerOnce: true)
5. Attach `elementRef` to the grid container div
6. Wrap each card item in a div with:
   - Initial state classes: `opacity-0 translate-y-5` (hidden, 20px below)
   - Transition classes: `transition-[opacity,transform] duration-[var(--duration-base)] ease-[var(--ease-smooth)]`
   - When isVisible, add: `opacity-100 translate-y-0` (visible, in position)
   - Use `cn()` to conditionally apply the visible state classes
   - Use inline `style={{ transitionDelay: isVisible ? \`${index * 50}ms\` : '0ms' }}` for stagger
   - The 50ms stagger per item creates subtle flow (CONTEXT.md: not dramatic cascade)
   - Cap stagger: if more than 10 items, cap delay at `Math.min(index, 9) * 50`ms (max 450ms total)

IMPORTANT: Do NOT animate the loading skeleton state. Only animate the actual project cards. If the component has a loading state, ensure skeletons render without animation classes.

**B. Modify `app/(home)/page.tsx`:**

Add scroll entrance animation to the "Recent Projects" section heading and subtitle:
1. Import `useIntersectionObserver` from `@/hooks/use-intersection-observer`
2. Import `cn` from `@/lib/utils` if not already imported
3. The page is already `"use client"` (has useQuery)
4. Create a second useIntersectionObserver instance for the section heading area
5. Wrap the h2 and p elements (heading + subtitle) in a div with:
   - Same opacity-0/translate-y-5 initial state
   - Same transition classes
   - Conditional opacity-100/translate-y-0 when visible
   - NO stagger needed for heading (it's a single block)

Do NOT animate the HeroSection. CONTEXT.md: "Hero section fully visible on page load, no scroll trigger."
Do NOT animate the LocalBusinessSchema component (it's invisible markup).
Do NOT add animation to body paragraphs or standard content.

CONTEXT.md locked decisions:
- Animation type: fade-up (opacity 0->1 + translateY 20px->0)
- Stagger: ~50ms between sibling items
- Replay: once only (triggerOnce: true default)
- Hero: no scroll animation
- Coverage: key sections only (~30%)
- Duration ceiling: ~200-250ms max (duration-base is 300ms, which is slightly over but acceptable for entrance animations which are "complex" category per existing tokens)
  </action>
  <verify>Run `bun run build` and confirm no TypeScript or build errors. Verify project-grid.tsx imports useIntersectionObserver. Verify app/(home)/page.tsx imports useIntersectionObserver. Confirm HeroSection has NO animation classes applied.</verify>
  <done>Project cards in the grid fade up with staggered timing when scrolling into view. Section heading animates in separately. Hero section remains fully visible on load. All animations play once and do not replay on scroll back. prefers-reduced-motion users see everything immediately.</done>
</task>

</tasks>

<verification>
1. `bun run build` passes with no errors
2. hooks/use-intersection-observer.ts exists and exports useIntersectionObserver
3. Hook checks prefers-reduced-motion and immediately resolves if enabled
4. Hook unobserves after first trigger (triggerOnce default)
5. project-grid.tsx uses useIntersectionObserver for staggered card entrance
6. app/(home)/page.tsx uses useIntersectionObserver for section heading entrance
7. HeroSection has NO scroll animation classes or refs
8. Stagger delay is 50ms per item, capped at ~450ms total
</verification>

<success_criteria>
- Scroll-triggered fade-up animations visible on project cards and section heading
- Stagger creates subtle flow between card appearances
- Hero section immediately visible on page load
- Animations play once only (no replay on scroll back)
- prefers-reduced-motion users see all content immediately
- Build passes, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/12-animation-integration/12-02-SUMMARY.md`
</output>
