---
phase: 17-public-blog-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - app/globals.css
  - components/blog/blog-post-card.tsx
  - components/blog/category-filter.tsx
  - components/blog/pagination-bar.tsx
  - app/blog/layout.tsx
  - app/blog/page.tsx
autonomous: true

must_haves:
  truths:
    - "Visiting /blog shows a hero section and either published posts or a 'coming soon' empty state"
    - "Category filter pills appear above the post list, hiding categories with zero posts"
    - "Selecting a category filters the list and resets to page 1"
    - "Numbered pagination appears when more than 10 posts exist"
    - "Blog post cards show cover image left, title/excerpt/meta right (horizontal layout)"
    - "Draft posts do not appear on the public blog list"
  artifacts:
    - path: "app/blog/page.tsx"
      provides: "Blog list page with Suspense boundary"
    - path: "app/blog/layout.tsx"
      provides: "Blog section metadata"
    - path: "components/blog/blog-post-card.tsx"
      provides: "Horizontal card component for blog list"
    - path: "components/blog/category-filter.tsx"
      provides: "Category pill filter with URL state"
    - path: "components/blog/pagination-bar.tsx"
      provides: "Numbered pagination with ellipsis"
    - path: "app/globals.css"
      provides: "Custom prose styles and highlight.js theme CSS"
  key_links:
    - from: "app/blog/page.tsx"
      to: "convex/blogPosts.ts:listPublished"
      via: "useQuery(api.blogPosts.listPublished)"
      pattern: "useQuery.*blogPosts\\.listPublished"
    - from: "components/blog/category-filter.tsx"
      to: "URL query params"
      via: "nuqs useQueryState"
      pattern: "useQueryState.*category"
    - from: "components/blog/pagination-bar.tsx"
      to: "URL query params"
      via: "nuqs useQueryState"
      pattern: "useQueryState.*page"
---

<objective>
Create the public blog list page at /blog with horizontal post cards, category filtering, numbered pagination, and a "coming soon" empty state.

Purpose: Enable visitors to discover and browse published blog posts, filtered by category, with classic numbered pagination. This is the primary blog entry point.

Output: Blog list page with hero section, category filter pills, horizontal post cards (image left, text right), pagination bar, and empty state. Plus foundation CSS (prose styles, highlight.js theme) needed by both this plan and Plan 02.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-public-blog-pages/17-CONTEXT.md
@.planning/phases/17-public-blog-pages/17-RESEARCH.md
@.planning/phases/15-content-schema-backend/15-02-SUMMARY.md

Key existing files to reference:
@app/projects/page.tsx - Example of nuqs + Convex useQuery + Suspense pattern for filtered list
@app/services/page.tsx - Example of SectionBackground hero pattern
@components/portfolio/sections/section-background.tsx - Reusable section wrapper
@components/navigation/site-nav.tsx - Nav links array (line 10)
@convex/blogPosts.ts - Existing listPublished query (line 73-120), getBySlug query (line 128-155)
@app/globals.css - Existing design tokens and theme configuration
@package.json - Current dependencies (react-markdown and remark-gfm already installed, nuqs installed)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and add prose + syntax highlighting CSS</name>
  <files>package.json, app/globals.css</files>
  <action>
1. Install missing dependencies:
```bash
bun add rehype-highlight highlight.js
```
Note: react-markdown, remark-gfm, and nuqs are already installed.

2. Add highlight.js theme CSS import to `app/globals.css`. Add it right after the `@plugin "tailwindcss-animate";` line:
```css
@import "highlight.js/styles/github-dark.css";
```
Use `github-dark` theme - it works well in both light and dark mode contexts and has good contrast.

3. Add custom `.prose` styles to `app/globals.css` in a new `@layer components` block AFTER the existing `@layer utilities` block at the end of the file. The prose styles should:
- Set `max-width: 65ch` and `margin: 0 auto` on `.prose`
- Use existing font-size tokens for headings: `var(--font-size-h2)` for h2, `var(--font-size-h3)` for h3, `var(--font-size-h4)` for h4 (no h1 in prose, the page provides the h1)
- Apply `font-family: var(--font-serif)` and appropriate leading to h2, h3 (serif headings per design system)
- h4+ use default sans-serif
- Paragraphs: `margin-bottom: 1.25em`, `line-height: 1.6` (relaxed)
- Lists (ul, ol): `margin-left: 1.5em`, `margin-bottom: 1.25em`, `list-style` appropriate (disc for ul, decimal for ol)
- List items: `margin-bottom: 0.5em`
- Blockquotes: `border-left: 4px solid hsl(var(--primary))`, `padding-left: 1rem`, `font-style: italic`, `color: hsl(var(--muted-foreground))`
- Code blocks (pre): `background: hsl(var(--muted))`, `padding: 1rem`, `border-radius: var(--radius-md)`, `overflow-x: auto`, `margin-bottom: 1.25em`
- Inline code: `background: hsl(var(--muted))`, `padding: 0.2em 0.4em`, `border-radius: var(--radius-sm)`, `font-size: 0.875em`
- Links: `color: hsl(var(--primary))`, `text-decoration: underline`, `text-underline-offset: 2px`
- Images in prose: `max-width: 100%`, `border-radius: var(--radius-md)`
- Tables: border-collapse, `border: 1px solid hsl(var(--border))` on th/td, padding
- Horizontal rules: `border-top: 1px solid hsl(var(--border))`, `margin: 2em 0`
- Heading spacing: `margin-top: 2em`, `margin-bottom: 0.75em` for h2/h3/h4

Do NOT use `@tailwindcss/typography` plugin. These are custom styles using existing design tokens.
  </action>
  <verify>
- `bun run type-check` passes
- `app/globals.css` contains the highlight.js import and `.prose` class with heading, paragraph, code, blockquote, link, table styles
- No existing styles are broken (check that new CSS is additive, not overriding)
  </verify>
  <done>
- rehype-highlight and highlight.js added to package.json dependencies
- globals.css has highlight.js theme import and comprehensive custom prose styles using existing design tokens
  </done>
</task>

<task type="auto">
  <name>Task 2: Create blog list page with components</name>
  <files>
    components/blog/blog-post-card.tsx
    components/blog/category-filter.tsx
    components/blog/pagination-bar.tsx
    app/blog/layout.tsx
    app/blog/page.tsx
  </files>
  <action>
1. **Create `components/blog/blog-post-card.tsx`** - A horizontal card component:
- Server Component (no "use client") - it receives data as props, no interactivity
- Props: `title: string`, `slug: string`, `excerpt: string`, `coverImageUrl: string | null`, `coverImageAlt: string | null`, `category: string`, `readingTime: number`, `publishedAt: number`
- Layout: Flexbox row (image left, content right). On mobile (`< md`), stack vertically (flex-col)
- Image container: `flex-shrink-0`, `w-full md:w-64 lg:w-72`, aspect-video, use Next.js `Image` component with `fill` and `object-cover`. Show a placeholder gray background if no cover image
- Content side: category `Badge` (variant="secondary"), title as `h3` with `font-serif text-h4 leading-snug`, excerpt with `line-clamp-2 text-muted-foreground`, meta row with formatted date and "X min read"
- Wrap entire card in `Link` to `/blog/${slug}`
- Use existing `Card` from shadcn/ui with `elevation="sm"` style (shadow-sm, rounded-lg, overflow-hidden, border)
- Hover: subtle shadow increase + slight translate-y via CSS transition (follow existing hover patterns)
- Format date using `new Date(publishedAt).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })`

2. **Create `components/blog/category-filter.tsx`** - Client Component:
- "use client" directive
- Props: `categories: string[]` (only categories with published posts, passed from parent), `selectedCategory: string | null`, `onCategoryChange: (category: string | null) => void`
- Render pill buttons using `Badge` component with cursor-pointer
- "All" button always first, uses `variant="default"` when no category selected, `variant="outline"` otherwise
- Each category pill: `variant="default"` when selected, `variant="outline"` otherwise
- Use `role="group"` and `aria-label="Filter by category"` on container
- Each badge is a `button` element for accessibility

3. **Create `components/blog/pagination-bar.tsx`** - Client Component:
- "use client" directive
- Props: `currentPage: number`, `totalPages: number`, `onPageChange: (page: number) => void`
- Full pagination bar: Previous button, page numbers with ellipsis for many pages, Next button
- Ellipsis logic (from RESEARCH.md):
  - 7 or fewer pages: show all
  - Current page <= 4: show [1,2,3,4,5,...,last]
  - Current page >= totalPages-3: show [1,...,last-4,last-3,last-2,last-1,last]
  - Otherwise: show [1,...,current-1,current,current+1,...,last]
- Use shadcn `Button` component with `variant="outline"` for unselected, `variant="default"` for current page
- Previous/Next disabled at boundaries
- Use `size="sm"` for all buttons
- `nav` element with `aria-label="Blog pagination"`
- Don't render pagination at all if totalPages <= 1

4. **Create `app/blog/layout.tsx`** - Static metadata:
```typescript
import type { Metadata } from "next";

export const metadata: Metadata = {
  title: "Blog",
  description: "Articles about local business web design, technical insights, and company updates from Jon Gerton.",
  openGraph: {
    title: "Blog | Jon Gerton",
    description: "Articles about local business web design, technical insights, and company updates.",
  },
};

export default function BlogLayout({ children }: { children: React.ReactNode }) {
  return children;
}
```

5. **Create `app/blog/page.tsx`** - Blog list page:
- Follow the same pattern as `app/projects/page.tsx`: outer default export wrapping content in `Suspense`, inner client component
- The inner `BlogListContent` component ("use client"):
  - Uses `useQuery(api.blogPosts.listPublished, categoryArg)` where categoryArg is `{ category }` if selected or `{}`
  - Uses nuqs: `useQueryState("category", parseAsString)` and `useQueryState("page", parseAsInteger.withDefault(1))`
  - Derives `visibleCategories` from all posts (needs an additional query without category filter to count categories, OR fetch all posts once and filter client-side). DECISION: Fetch with `useQuery(api.blogPosts.listPublished, {})` for the full list to count categories, and filter client-side. This is simpler and works for <100 posts.
  - Actually, simplify: ONE query `useQuery(api.blogPosts.listPublished, {})` fetches all published posts. Client-side: filter by selected category, slice by page. This gives us category counts for free.
  - When category changes, reset page to 1 via `setPage(1)` in the category change handler
  - Compute `totalPages = Math.ceil(filteredPosts.length / 10)`
  - Compute `currentPosts = filteredPosts.slice((page - 1) * 10, page * 10)`
  - Show skeleton/loading state when `posts === undefined`

- Page layout structure:
  1. Hero section using `SectionBackground variant="neutral"`:
     - `h1` with `font-serif font-semibold text-h1 leading-tight mb-md`: "Blog"
     - Subtitle `p` with `text-xl text-muted-foreground`: "Insights on web design, local business growth, and the tech behind it all."
  2. Content section using `SectionBackground variant="muted"`:
     - `CategoryFilter` component
     - If posts loaded and filtered list empty AND no category selected: show "Coming Soon" empty state with friendly message and CTA button linking to /contact ("Book a Call" or "Check Back Soon")
     - If posts loaded and filtered list empty AND category IS selected: show "No posts in this category yet" message
     - If posts loaded and have items: render `BlogPostCard` list with `space-y-lg` gap
     - `PaginationBar` at bottom (only if totalPages > 1)
     - Loading skeleton: 3 placeholder cards with animated pulse

- Import and use existing components: `SectionBackground`, `Badge`, `Button`, `Link` from next/link
  </action>
  <verify>
- `bun run type-check` passes with no errors
- `bun run lint` passes with no errors
- All files exist: `app/blog/page.tsx`, `app/blog/layout.tsx`, `components/blog/blog-post-card.tsx`, `components/blog/category-filter.tsx`, `components/blog/pagination-bar.tsx`
- Blog page uses `Suspense` boundary (matching projects page pattern)
- Category filter uses nuqs for URL state
- Pagination uses nuqs for URL state
- Empty state has CTA
- Cards use Next.js Image component
  </verify>
  <done>
- Blog list page renders at /blog with hero section and either post cards or empty state
- Category filter appears with pill buttons, hides categories with no posts
- Pagination bar appears when >10 posts, with correct page number and ellipsis logic
- Post cards show horizontal layout (image left, content right) with all required metadata
- Draft posts are excluded (uses listPublished query)
- URL updates when changing category or page (nuqs)
  </done>
</task>

</tasks>

<verification>
1. `bun run type-check` passes
2. `bun run lint` passes
3. Navigate to /blog in browser - hero section visible
4. With no published posts: "Coming soon" empty state with CTA appears
5. With published posts: horizontal cards display with cover image, title, excerpt, category badge, date, reading time
6. Category filter shows only categories with published content
7. Clicking a category filters the list and resets to page 1
8. Pagination appears when >10 posts exist
9. URL updates reflect category and page state
10. Draft posts do not appear in the list
</verification>

<success_criteria>
- /blog page loads and displays published blog posts in horizontal card format
- Category filtering works via URL query params
- Numbered pagination works with 10 posts per page
- Empty state shows when no published posts exist
- Custom prose styles exist in globals.css for Plan 02 to use
- highlight.js theme CSS is imported
</success_criteria>

<output>
After completion, create `.planning/phases/17-public-blog-pages/17-01-SUMMARY.md`
</output>
