---
phase: 04-admin-dashboard
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - components/admin/image-upload-zone.tsx
  - components/admin/sortable-project-list.tsx
  - components/admin/sortable-project-row.tsx
  - components/admin/confirm-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "Image upload supports both drag-and-drop AND click-to-browse"
    - "Project list rows can be reordered via drag-and-drop"
    - "Delete actions show confirmation dialog"
  artifacts:
    - path: "components/admin/image-upload-zone.tsx"
      provides: "Drag-drop and click file upload"
      contains: "useDropzone"
    - path: "components/admin/sortable-project-list.tsx"
      provides: "Sortable list with dnd-kit"
      contains: "DndContext"
    - path: "components/admin/confirm-dialog.tsx"
      provides: "Confirmation dialog for destructive actions"
      contains: "AlertDialog"
  key_links:
    - from: "components/admin/image-upload-zone.tsx"
      to: "convex/projects generateUploadUrl"
      via: "useMutation"
      pattern: "generateUploadUrl"
---

<objective>
Install dnd-kit and react-dropzone, create image upload and sortable list components.

Purpose: Reusable UI components for project management - needed before building project pages.
Output: Working image upload zone, sortable project list, and confirm dialog components.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-admin-dashboard/04-RESEARCH.md
@convex/projects.ts
@components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dnd-kit and react-dropzone</name>
  <files>package.json</files>
  <action>
Install required packages:

```bash
bun add @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities react-dropzone
```

These libraries:
- @dnd-kit/core: Foundation for drag-and-drop
- @dnd-kit/sortable: Preset for sortable lists
- @dnd-kit/utilities: Helper functions (arrayMove, CSS transforms)
- react-dropzone: File upload with drag-drop and click-to-browse
  </action>
  <verify>
- All four packages in package.json dependencies
- `bun install` completes without errors
  </verify>
  <done>dnd-kit and react-dropzone installed</done>
</task>

<task type="auto">
  <name>Task 2: Create image upload zone component</name>
  <files>components/admin/image-upload-zone.tsx</files>
  <action>
Create components/admin/image-upload-zone.tsx:

1. "use client"

2. Imports:
   - useDropzone from react-dropzone
   - useMutation from convex/react
   - api from @/convex/_generated/api
   - Upload icon from lucide-react

3. Props interface:
   ```typescript
   interface ImageUploadZoneProps {
     onUploadComplete: (storageId: string) => void;
     currentImageUrl?: string | null;
     className?: string;
   }
   ```

4. Implementation:
   - Get generateUploadUrl mutation from api.projects.generateUploadUrl
   - State for uploading (boolean) and preview (string | null)

   - onDrop callback (LOCKED: both drag-drop AND click-to-browse):
     a. Set uploading = true
     b. Generate upload URL: await generateUploadUrl()
     c. POST file to URL with Content-Type header
     d. Extract storageId from response JSON
     e. Create preview URL with URL.createObjectURL(file)
     f. Call onUploadComplete(storageId)
     g. Set uploading = false

   - useDropzone config:
     - onDrop: onDrop callback
     - accept: { 'image/*': ['.png', '.jpg', '.jpeg', '.webp', '.gif'] }
     - maxFiles: 1
     - multiple: false

5. UI (LOCKED: drag-drop zone that also responds to click):
   ```tsx
   <div
     {...getRootProps()}
     className={cn(
       "border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",
       isDragActive ? "border-primary bg-primary/5" : "border-muted-foreground/25 hover:border-primary/50",
       className
     )}
   >
     <input {...getInputProps()} />
     {uploading ? (
       <p>Uploading...</p>
     ) : preview || currentImageUrl ? (
       <div>
         <img src={preview || currentImageUrl} alt="Preview" className="max-h-48 mx-auto mb-2 rounded" />
         <p className="text-sm text-muted-foreground">Drop a new image or click to replace</p>
       </div>
     ) : (
       <div>
         <Upload className="mx-auto h-12 w-12 text-muted-foreground mb-2" />
         <p>Drag and drop an image here, or click to browse</p>
         <p className="text-sm text-muted-foreground mt-1">PNG, JPG, WebP up to 10MB</p>
       </div>
     )}
   </div>
   ```

Note: Generate URL immediately before upload, not on component mount (avoids expiration issues).
  </action>
  <verify>
- components/admin/image-upload-zone.tsx exists
- Uses useDropzone with accept image types
- Has both drag-drop and click-to-browse capability
- `bun run type-check` passes
  </verify>
  <done>Image upload zone supports drag-drop and click-to-browse</done>
</task>

<task type="auto">
  <name>Task 3: Create sortable project list and confirm dialog</name>
  <files>
    - components/admin/sortable-project-list.tsx
    - components/admin/sortable-project-row.tsx
    - components/admin/confirm-dialog.tsx
  </files>
  <action>
1. Create components/admin/confirm-dialog.tsx:
   - Use existing shadcn AlertDialog component (or Dialog if AlertDialog not available)
   - Props: open, onOpenChange, title, description, onConfirm, confirmText?, destructive?
   - Red "Delete" button for destructive actions
   - "Cancel" button to close

   ```tsx
   interface ConfirmDialogProps {
     open: boolean;
     onOpenChange: (open: boolean) => void;
     title: string;
     description: string;
     onConfirm: () => void;
     confirmText?: string;
     destructive?: boolean;
   }
   ```

2. Create components/admin/sortable-project-row.tsx:
   - "use client"
   - Uses useSortable from @dnd-kit/sortable
   - Props: project (with _id, name, status, featured, screenshotUrl)
   - Renders table row with:
     - Drag handle (GripVertical icon)
     - Screenshot thumbnail (small)
     - Project name
     - Status badge
     - Featured toggle/indicator
     - Edit link
     - Delete button (triggers confirm dialog)

   ```tsx
   const { attributes, listeners, setNodeRef, transform, transition, isDragging } = useSortable({ id: project._id });

   const style = {
     transform: CSS.Transform.toString(transform),
     transition,
     opacity: isDragging ? 0.5 : 1,
   };
   ```

3. Create components/admin/sortable-project-list.tsx:
   - "use client"
   - Imports from @dnd-kit/core: DndContext, closestCenter, KeyboardSensor, PointerSensor, useSensor, useSensors
   - Imports from @dnd-kit/sortable: SortableContext, sortableKeyboardCoordinates, verticalListSortingStrategy
   - Imports arrayMove from @dnd-kit/utilities

   - Props: projects, onReorder, onDelete
   - Sensors: PointerSensor, KeyboardSensor with sortableKeyboardCoordinates

   - handleDragEnd:
     a. Get active.id and over.id
     b. If different, calculate oldIndex and newIndex
     c. Call onReorder with arrayMove result

   - Structure:
     ```tsx
     <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
       <SortableContext items={projects.map(p => p._id)} strategy={verticalListSortingStrategy}>
         <table className="w-full">
           <thead>
             <tr>
               <th className="w-8"></th> {/* Drag handle */}
               <th>Image</th>
               <th>Name</th>
               <th>Status</th>
               <th>Featured</th>
               <th>Actions</th>
             </tr>
           </thead>
           <tbody>
             {projects.map(project => (
               <SortableProjectRow
                 key={project._id}
                 project={project}
                 onDelete={() => onDelete(project)}
               />
             ))}
           </tbody>
         </table>
       </SortableContext>
     </DndContext>
     ```
  </action>
  <verify>
- components/admin/confirm-dialog.tsx exists
- components/admin/sortable-project-list.tsx exists with DndContext
- components/admin/sortable-project-row.tsx exists with useSortable
- `bun run type-check` passes
  </verify>
  <done>Sortable project list and confirm dialog components exist</done>
</task>

</tasks>

<verification>
- [ ] @dnd-kit/core, @dnd-kit/sortable, @dnd-kit/utilities, react-dropzone in package.json
- [ ] ImageUploadZone supports drag-drop and click-to-browse
- [ ] SortableProjectList uses DndContext with vertical strategy
- [ ] ConfirmDialog shows before destructive actions
- [ ] `bun run type-check` passes
- [ ] `bun run lint` passes
</verification>

<success_criteria>
- All drag-and-drop libraries installed
- Image upload zone works with both drag-drop and click
- Project list rows are draggable for reordering
- Confirm dialog component ready for delete actions
- All components properly typed
</success_criteria>

<output>
After completion, create `.planning/phases/04-admin-dashboard/04-04-SUMMARY.md`
</output>
