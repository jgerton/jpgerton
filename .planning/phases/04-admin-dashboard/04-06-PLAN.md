---
phase: 04-admin-dashboard
plan: 06
type: execute
wave: 4
depends_on: ["04-04", "04-05"]
files_modified:
  - app/admin/projects/page.tsx
  - app/admin/projects/new/page.tsx
  - app/admin/projects/[id]/edit/page.tsx
  - components/admin/project-form.tsx
autonomous: true

must_haves:
  truths:
    - "Projects list shows all projects with drag-to-reorder"
    - "Create project form has all fields including image upload"
    - "Edit project form loads existing data and saves changes"
    - "Delete project shows confirmation dialog"
  artifacts:
    - path: "app/admin/projects/page.tsx"
      provides: "Sortable project list page"
      contains: "SortableProjectList"
    - path: "app/admin/projects/new/page.tsx"
      provides: "Create project page"
      contains: "ProjectForm"
    - path: "app/admin/projects/[id]/edit/page.tsx"
      provides: "Edit project page"
      contains: "ProjectForm"
    - path: "components/admin/project-form.tsx"
      provides: "Reusable project form"
      min_lines: 100
  key_links:
    - from: "app/admin/projects/page.tsx"
      to: "convex/projects reorder"
      via: "useMutation"
      pattern: "reorder"
    - from: "components/admin/project-form.tsx"
      to: "components/admin/image-upload-zone.tsx"
      via: "import"
      pattern: "ImageUploadZone"
---

<objective>
Build project management pages: list with reordering, create form, and edit form.

Purpose: Enable Jon to manage portfolio content - the core admin function.
Output: Full CRUD interface for projects with drag-to-reorder.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-admin-dashboard/04-CONTEXT.md
@convex/projects.ts
@convex/schema.ts
@components/admin/sortable-project-list.tsx
@components/admin/image-upload-zone.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project form component</name>
  <files>components/admin/project-form.tsx</files>
  <action>
Create components/admin/project-form.tsx:

1. "use client"

2. Props interface:
   ```typescript
   interface ProjectFormProps {
     mode: "create" | "edit";
     initialData?: Project;
     onSubmit: (data: ProjectFormData) => Promise<void>;
     onCancel: () => void;
   }

   interface ProjectFormData {
     name: string;
     slug: string;
     description: string;
     descriptionLong?: string;
     status: "live" | "archived" | "in-progress";
     techStack: string[];
     techCategories: {
       frontend: string[];
       backend: string[];
       infrastructure: string[];
     };
     liveUrl?: string;
     githubUrl?: string;
     featured: boolean;
     screenshotId?: string;
   }
   ```

3. Form structure (LOCKED: full page form):
   - Section 1: Basic Info
     - Name (required, text input)
     - Slug (auto-generated from name, editable)
     - Description (required, short text)
     - Long Description (optional, textarea)

   - Section 2: Image
     - ImageUploadZone component
     - Shows current image if editing

   - Section 3: Tech Stack
     - Frontend techs (comma-separated or tag input)
     - Backend techs
     - Infrastructure techs
     - Combined techStack array generated from all three

   - Section 4: Links
     - Live URL (optional)
     - GitHub URL (optional)

   - Section 5: Status & Visibility
     - Status dropdown: live, in-progress, archived
     - Featured checkbox

4. Form state management:
   - Use react-hook-form with zodResolver
   - Create Zod schema for validation
   - Handle loading state during submission

5. Slug generation:
   - Auto-generate from name (lowercase, hyphenated)
   - Allow manual override
   - Validate uniqueness on blur (optional, can defer)

6. Submit handling:
   - Disable button during submission
   - Show loading indicator
   - Call onSubmit prop with form data
   - onSubmit handles actual mutation
  </action>
  <verify>
- components/admin/project-form.tsx exists
- Has all project fields
- Uses ImageUploadZone for screenshot
- Uses react-hook-form + zod for validation
- `bun run type-check` passes
  </verify>
  <done>Project form component handles all fields including image upload</done>
</task>

<task type="auto">
  <name>Task 2: Build projects list page with drag-to-reorder</name>
  <files>app/admin/projects/page.tsx</files>
  <action>
Replace app/admin/projects/page.tsx placeholder:

1. "use client"

2. Imports:
   - useQuery, useMutation from convex/react
   - api from @/convex/_generated/api
   - SortableProjectList, ConfirmDialog components
   - Link from next/link
   - Plus icon from lucide-react

3. Queries and mutations:
   - projects = useQuery(api.projects.list)
   - reorder = useMutation(api.projects.reorder)
   - remove = useMutation(api.projects.remove)

4. State:
   - deleteTarget: Project | null (for confirm dialog)

5. Handlers:
   - handleReorder: Debounce mutation calls
     - Optimistic update: Update local state immediately
     - Call reorder mutation with new order
     - On error: Toast error message

   - handleDelete:
     - Set deleteTarget to show confirm dialog
     - On confirm: Call remove mutation
     - On success: Toast success, clear deleteTarget
     - On error: Toast error

6. Layout:
   ```tsx
   <div className="space-y-6">
     <div className="flex items-center justify-between">
       <h1 className="text-2xl font-bold">Projects</h1>
       <Link href="/admin/projects/new">
         <Button>
           <Plus className="h-4 w-4 mr-2" />
           Add Project
         </Button>
       </Link>
     </div>

     {projects === undefined ? (
       <div>Loading...</div>
     ) : projects.length === 0 ? (
       <Card className="py-12 text-center">
         <p>No projects yet. Add your first project!</p>
         <Link href="/admin/projects/new">
           <Button className="mt-4">Add Project</Button>
         </Link>
       </Card>
     ) : (
       <SortableProjectList
         projects={projects}
         onReorder={handleReorder}
         onDelete={(project) => setDeleteTarget(project)}
       />
     )}

     <ConfirmDialog
       open={deleteTarget !== null}
       onOpenChange={(open) => !open && setDeleteTarget(null)}
       title="Delete Project"
       description={`Are you sure you want to delete "${deleteTarget?.name}"? This cannot be undone.`}
       onConfirm={handleDeleteConfirm}
       destructive
     />
   </div>
   ```

7. Reorder debouncing:
   - Use useRef to track pending reorder
   - Debounce by 500ms to avoid rapid mutations
   - Or use optimistic updates pattern from Convex
  </action>
  <verify>
- app/admin/projects/page.tsx shows project list
- Drag-and-drop reorders projects
- Delete shows confirmation dialog
- "Add Project" button links to /admin/projects/new
- `bun run type-check` passes
  </verify>
  <done>Projects list page with drag-to-reorder and delete confirmation</done>
</task>

<task type="auto">
  <name>Task 3: Build create and edit project pages</name>
  <files>
    - app/admin/projects/new/page.tsx
    - app/admin/projects/[id]/edit/page.tsx
  </files>
  <action>
1. Create app/admin/projects/new/page.tsx:
   - "use client"
   - Import useMutation, useRouter
   - Import ProjectForm component

   - Get create mutation: useMutation(api.projects.create)
   - Get router for navigation

   - handleSubmit:
     a. Call create mutation with form data
     b. On success: toast success, router.push('/admin/projects')
     c. On error: toast error

   - handleCancel: router.push('/admin/projects')

   - Layout:
     ```tsx
     <div className="max-w-2xl mx-auto space-y-6">
       <h1 className="text-2xl font-bold">Add New Project</h1>
       <ProjectForm
         mode="create"
         onSubmit={handleSubmit}
         onCancel={handleCancel}
       />
     </div>
     ```

2. Create app/admin/projects/[id]/edit/page.tsx:
   - "use client"
   - Import useQuery, useMutation, useRouter
   - Import ProjectForm component
   - Use useParams to get project ID

   - Query project by ID (need to add getById query to projects.ts if not exists)
   - Get update mutation: useMutation(api.projects.update)

   - handleSubmit:
     a. Call update mutation with id + form data
     b. On success: toast success, router.push('/admin/projects')
     c. On error: toast error

   - Loading state while project loads
   - 404 handling if project not found

   - Layout:
     ```tsx
     <div className="max-w-2xl mx-auto space-y-6">
       <h1 className="text-2xl font-bold">Edit Project</h1>
       {project === undefined ? (
         <div>Loading...</div>
       ) : project === null ? (
         <div>Project not found</div>
       ) : (
         <ProjectForm
           mode="edit"
           initialData={project}
           onSubmit={handleSubmit}
           onCancel={handleCancel}
         />
       )}
     </div>
     ```

3. Add getById query to convex/projects.ts if not exists:
   ```typescript
   export const getById = query({
     args: { id: v.id("projects") },
     handler: async (ctx, args) => {
       const userId = await getAuthUserId(ctx);
       if (!userId) throw new Error("Unauthorized");

       const project = await ctx.db.get(args.id);
       if (!project) return null;

       const screenshotUrl = project.screenshotId
         ? await ctx.storage.getUrl(project.screenshotId)
         : null;

       return { ...project, screenshotUrl };
     },
   });
   ```
  </action>
  <verify>
- app/admin/projects/new/page.tsx renders create form
- app/admin/projects/[id]/edit/page.tsx renders edit form with existing data
- Creating project adds to list
- Editing project updates existing data
- Changes appear on public site immediately
- `bun run type-check` passes
  </verify>
  <done>Create and edit project pages functional with full form</done>
</task>

</tasks>

<verification>
- [ ] Project form has all fields (name, slug, description, image, tech stack, links, status, featured)
- [ ] Projects list page shows sortable table
- [ ] Drag-and-drop reorders projects
- [ ] Delete shows confirmation dialog
- [ ] Create form at /admin/projects/new works
- [ ] Edit form at /admin/projects/[id]/edit loads existing data
- [ ] Changes reflect on public site immediately (Convex reactivity)
- [ ] Image upload works in form
- [ ] `bun run type-check` passes
- [ ] `bun run lint` passes
</verification>

<success_criteria>
- Full CRUD for projects: create, read, update, delete
- Drag-and-drop reordering changes displayOrder
- Featured toggle works
- Image upload integrated into form
- Changes appear on public portfolio immediately
- Delete requires confirmation (no accidental deletes)
</success_criteria>

<output>
After completion, create `.planning/phases/04-admin-dashboard/04-06-SUMMARY.md`
</output>
