---
phase: 04-admin-dashboard
plan: 05
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - app/admin/page.tsx
  - app/admin/contacts/page.tsx
  - components/admin/contacts-table.tsx
  - components/admin/stats-card.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard home shows recent contact submissions with quick stats"
    - "Contacts page displays inbox-style list (unread at top)"
    - "Contacts support four-state workflow and bulk archive"
  artifacts:
    - path: "app/admin/page.tsx"
      provides: "Dashboard home with stats and recent contacts"
      min_lines: 50
    - path: "app/admin/contacts/page.tsx"
      provides: "Contacts inbox page"
      min_lines: 80
    - path: "components/admin/contacts-table.tsx"
      provides: "Table with checkbox selection and bulk actions"
      contains: "checkbox"
  key_links:
    - from: "app/admin/page.tsx"
      to: "convex/contacts list"
      via: "useQuery"
      pattern: "useQuery.*contacts.*list"
    - from: "components/admin/contacts-table.tsx"
      to: "convex/contacts archiveBulk"
      via: "useMutation"
      pattern: "archiveBulk"
---

<objective>
Build dashboard home with quick stats and contacts page with inbox-style list.

Purpose: Enable Jon to triage contact submissions - the most time-sensitive admin function.
Output: Working dashboard overview and contacts management interface.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-admin-dashboard/04-CONTEXT.md
@convex/contacts.ts
@convex/schema.ts
@components/ui/card.tsx
@components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create stats card and dashboard home</name>
  <files>
    - components/admin/stats-card.tsx
    - app/admin/page.tsx
  </files>
  <action>
1. Create components/admin/stats-card.tsx:
   - Simple card displaying a stat with label
   - Props: label, value, trend? (optional up/down indicator)
   - Uses Card component from shadcn

   ```tsx
   interface StatsCardProps {
     label: string;
     value: string | number;
     icon?: React.ReactNode;
     className?: string;
   }
   ```

2. Replace app/admin/page.tsx placeholder:
   - "use client"
   - Import useQuery from convex/react
   - Query contacts.list for stats calculation

   - Quick stats section (grid of 3-4 cards):
     - Total unread contacts (status === "unread")
     - Total projects (could query projects.list)
     - Contacts this week
     - Response rate (optional, can defer)

   - Recent contacts section:
     - Heading: "Recent Contact Submissions"
     - Show last 5 contacts (most recent)
     - Each row: name, email, project type, time ago, status badge
     - Link to /admin/contacts for full list

   - Layout:
     ```tsx
     <div className="space-y-6">
       <h1 className="text-2xl font-bold">Dashboard</h1>

       <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
         <StatsCard label="Unread Messages" value={unreadCount} icon={<Mail />} />
         <StatsCard label="Total Projects" value={projectCount} icon={<Folder />} />
         <StatsCard label="This Week" value={weekCount} icon={<Calendar />} />
       </div>

       <Card>
         <CardHeader>
           <CardTitle>Recent Contact Submissions</CardTitle>
         </CardHeader>
         <CardContent>
           {/* Recent contacts table/list */}
         </CardContent>
       </Card>
     </div>
     ```

   - Handle loading state (show skeleton or spinner)
   - Handle empty state (no contacts yet)
  </action>
  <verify>
- components/admin/stats-card.tsx exists
- app/admin/page.tsx shows stats and recent contacts
- Visit /admin displays dashboard with real data
- `bun run type-check` passes
  </verify>
  <done>Dashboard home displays stats and recent contacts</done>
</task>

<task type="auto">
  <name>Task 2: Create contacts table with bulk actions</name>
  <files>components/admin/contacts-table.tsx</files>
  <action>
Create components/admin/contacts-table.tsx:

1. "use client"

2. Props interface:
   ```typescript
   interface ContactsTableProps {
     contacts: Contact[];
     onStatusChange: (id: string, status: ContactStatus) => void;
     onArchiveBulk: (ids: string[]) => void;
   }

   type ContactStatus = "unread" | "read" | "responded" | "archived";
   ```

3. State:
   - selected: Set<string> for selected contact IDs

4. Selection logic (LOCKED: checkboxes for bulk actions):
   - toggleAll: Select/deselect all visible contacts
   - toggleOne: Toggle individual contact selection
   - Clear selection after bulk action

5. Bulk action bar (shown when selection.size > 0):
   ```tsx
   {selected.size > 0 && (
     <div className="flex items-center gap-4 p-3 bg-muted rounded-lg mb-4">
       <span className="text-sm font-medium">{selected.size} selected</span>
       <Button variant="outline" size="sm" onClick={handleBulkArchive}>
         <Archive className="h-4 w-4 mr-2" />
         Archive Selected
       </Button>
       <Button variant="ghost" size="sm" onClick={() => setSelected(new Set())}>
         Clear
       </Button>
     </div>
   )}
   ```

6. Table structure:
   - Columns: Checkbox, Status, Name, Email, Project Type, Date, Actions
   - Status column: Badge with color per status
     - unread: red/orange (needs attention)
     - read: blue/gray
     - responded: green
   - Actions column: dropdown with status change options

7. Row click behavior:
   - Clicking row (not checkbox) marks as read if unread
   - Show inline expanded details, or plan to add detail panel

8. Status badges:
   ```tsx
   const statusColors = {
     unread: "bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",
     read: "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",
     responded: "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",
   };
   ```
  </action>
  <verify>
- components/admin/contacts-table.tsx exists
- Has checkbox column for selection
- Bulk archive action works
- Status badges display correctly
- `bun run type-check` passes
  </verify>
  <done>Contacts table supports bulk selection and status changes</done>
</task>

<task type="auto">
  <name>Task 3: Build contacts page with inbox-style layout</name>
  <files>app/admin/contacts/page.tsx</files>
  <action>
Replace app/admin/contacts/page.tsx placeholder:

1. "use client"

2. Imports:
   - useQuery, useMutation from convex/react
   - api from @/convex/_generated/api
   - ContactsTable component

3. Queries and mutations:
   - contacts = useQuery(api.contacts.list)
   - updateStatus = useMutation(api.contacts.updateStatus)
   - archiveBulk = useMutation(api.contacts.archiveBulk)

4. Layout (LOCKED: inbox-style, unread at top):
   ```tsx
   <div className="space-y-6">
     <div className="flex items-center justify-between">
       <h1 className="text-2xl font-bold">Contact Submissions</h1>
       {/* Optional: filter tabs (All, Unread, Archived) */}
     </div>

     {contacts === undefined ? (
       <div>Loading...</div>
     ) : contacts.length === 0 ? (
       <Card>
         <CardContent className="py-12 text-center">
           <Inbox className="mx-auto h-12 w-12 text-muted-foreground mb-4" />
           <p className="text-muted-foreground">No contact submissions yet</p>
         </CardContent>
       </Card>
     ) : (
       <ContactsTable
         contacts={contacts}
         onStatusChange={handleStatusChange}
         onArchiveBulk={handleArchiveBulk}
       />
     )}
   </div>
   ```

5. Handlers:
   - handleStatusChange: Call updateStatus mutation
   - handleArchiveBulk: Call archiveBulk mutation, show toast on success

6. Detail view (Claude's discretion - inline expand):
   - When user clicks a contact row (not checkbox):
     - Mark as read if unread
     - Expand row to show full message content
     - Show reply action (mailto link or copy email)
     - Show status change dropdown

7. Optional filter tabs:
   - All (default): Show non-archived
   - Unread: Filter to unread only
   - Archived: Show archived contacts
   - Use URL params or local state for filter
  </action>
  <verify>
- app/admin/contacts/page.tsx uses real Convex data
- Contacts sorted: unread first, then read, then responded
- Clicking row expands to show message
- Bulk archive works
- Status changes update immediately (Convex reactivity)
- `bun run type-check` passes
  </verify>
  <done>Contacts page displays inbox-style list with four-state workflow</done>
</task>

</tasks>

<verification>
- [ ] Dashboard shows unread count, project count, and recent contacts
- [ ] Contacts page displays all submissions sorted by status
- [ ] Unread contacts appear at top (inbox-style)
- [ ] Checkbox selection enables bulk archive
- [ ] Status can be changed: unread -> read -> responded -> archived
- [ ] Detail view shows full message content
- [ ] Convex reactivity updates UI instantly
- [ ] `bun run type-check` passes
- [ ] `bun run lint` passes
</verification>

<success_criteria>
- Dashboard home shows quick stats and recent contacts
- Contacts page works like email inbox (unread at top)
- Four-state workflow functional (unread/read/responded/archived)
- Bulk archive with checkbox selection works
- All data is real (from Convex, not mocked)
</success_criteria>

<output>
After completion, create `.planning/phases/04-admin-dashboard/04-05-SUMMARY.md`
</output>
