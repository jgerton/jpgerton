---
phase: 04-admin-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/auth.config.ts
  - convex/auth.ts
  - convex/schema.ts
  - convex/convex.config.ts
  - app/login/page.tsx
  - lib/auth.ts
autonomous: true
user_setup:
  - service: convex-auth
    why: "Admin authentication"
    env_vars:
      - name: AUTH_SECRET
        source: "Generate with: openssl rand -base64 32"
      - name: SITE_URL
        source: "Set to http://localhost:3400 for local dev"

must_haves:
  truths:
    - "Convex Auth Password provider is configured with 7-day sessions"
    - "Contact submissions support four-state workflow (unread, read, responded, archived)"
    - "Login page renders with email/password form"
  artifacts:
    - path: "convex/auth.config.ts"
      provides: "Convex Auth configuration"
      contains: "Password"
    - path: "convex/auth.ts"
      provides: "Auth exports for mutations"
      exports: ["auth", "signIn", "signOut"]
    - path: "convex/schema.ts"
      provides: "Updated contact status enum"
      contains: "responded"
    - path: "app/login/page.tsx"
      provides: "Login form UI"
      min_lines: 40
  key_links:
    - from: "convex/auth.ts"
      to: "convex/auth.config.ts"
      via: "import"
      pattern: "import.*auth.config"
---

<objective>
Setup Convex Auth with Password provider and 7-day sessions, update schema for four-state contact workflow, and create login page.

Purpose: Foundation for all admin authentication - must be in place before any protected routes.
Output: Working auth configuration, updated schema, and login UI.
</objective>

<execution_context>
@C:\Users\jonge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jonge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-admin-dashboard/04-RESEARCH.md
@convex/schema.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Convex Auth and configure Password provider</name>
  <files>
    - convex/auth.config.ts
    - convex/auth.ts
    - convex/convex.config.ts
    - lib/auth.ts
  </files>
  <action>
1. Install @convex-dev/auth:
   ```bash
   bun add @convex-dev/auth
   ```

2. Create convex/auth.config.ts:
   - Import Password from @convex-dev/auth/providers/Password
   - Import convexAuth from @convex-dev/auth/server
   - Configure with Password provider
   - Set session.totalDurationMs to 7 * 24 * 60 * 60 * 1000 (7 days - LOCKED decision)
   - Set session.inactiveDurationMs to 7 * 24 * 60 * 60 * 1000 (7 days idle timeout)
   - Export { auth, signIn, signOut, store, isAuthenticated }

3. Create convex/auth.ts:
   - Re-export auth functions for use in mutations
   - Export getAuthUserId helper

4. Update convex/convex.config.ts:
   - Add auth component configuration if needed

5. Create lib/auth.ts:
   - Export client-side auth helpers (useAuthActions hook pattern)
   - Export type definitions for auth state

Note: Do NOT use jose library for custom JWT - Convex Auth handles sessions internally.
  </action>
  <verify>
- convex/auth.config.ts exists with Password provider
- Session duration is 7 days (604800000 ms)
- `bun run type-check` passes
  </verify>
  <done>Convex Auth configured with Password provider and 7-day sessions</done>
</task>

<task type="auto">
  <name>Task 2: Update contact schema for four-state workflow</name>
  <files>convex/schema.ts</files>
  <action>
Update the contactSubmissions table status field from three-state to four-state:

Current: v.union(v.literal("new"), v.literal("read"), v.literal("archived"))
New: v.union(v.literal("unread"), v.literal("read"), v.literal("responded"), v.literal("archived"))

Changes:
- Rename "new" to "unread" for clarity (matches inbox mental model)
- Add "responded" state between read and archived

Also update the default value in contacts.ts create mutation from "new" to "unread".

Note: Existing data in database may have "new" status - this is fine for development, but in production would need migration.
  </action>
  <verify>
- convex/schema.ts has four status values: unread, read, responded, archived
- `bun run type-check` passes
  </verify>
  <done>Contact schema supports four-state workflow (unread -> read -> responded -> archived)</done>
</task>

<task type="auto">
  <name>Task 3: Create login page with email/password form</name>
  <files>app/login/page.tsx</files>
  <action>
Create app/login/page.tsx:

1. Layout:
   - Center the form on page (flex justify-center items-center min-h-screen)
   - Card container with padding
   - "Admin Login" heading
   - Subtitle: "Sign in to manage your portfolio"

2. Form fields:
   - Email input (type="email", required)
   - Password input (type="password", required, min 8 chars)
   - Submit button "Sign In"

3. State management:
   - Use React useState for form state and error display
   - Loading state during submission
   - Error message display below form

4. Authentication:
   - On submit, call Convex Auth signIn with Password provider
   - On success, redirect to /admin
   - On error, display "Invalid email or password" message

5. Styling:
   - Use existing shadcn components (Button, Input, Label, Card)
   - Simple, professional look - not marketing-style
   - Support dark mode via existing theme system

6. Mark as client component ("use client")
  </action>
  <verify>
- app/login/page.tsx exists
- Visit http://localhost:3400/login shows login form
- Form has email and password fields
- `bun run type-check` passes
  </verify>
  <done>Login page renders with email/password form</done>
</task>

</tasks>

<verification>
- [ ] @convex-dev/auth in package.json dependencies
- [ ] convex/auth.config.ts exports Password provider config
- [ ] Session duration set to 7 days
- [ ] convex/schema.ts has four contact statuses
- [ ] app/login/page.tsx renders login form
- [ ] `bun run type-check` passes
- [ ] `bun run lint` passes
</verification>

<success_criteria>
- Convex Auth is installed and configured with Password provider
- Sessions last 7 days (user decision honored)
- Contact schema supports unread/read/responded/archived workflow
- Login page exists at /login with working form UI
- All type checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/04-admin-dashboard/04-01-SUMMARY.md`
</output>
